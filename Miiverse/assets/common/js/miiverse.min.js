var Olv=Olv||{};(function($,Olv){if(!Olv.init){Olv.init=$.Deferred(function(){$(this.resolve)}).promise(),Olv.Utils={},Olv.Utils.isIE8AndEarlierStyle=!!document.createStyleSheet&&void 0===document.documentElement.style.opacity,Olv.Utils.isIEStyle=!!window.TextRange,Olv.Utils.addPlatformClass=function(){var e=$(document.documentElement),t=navigator.userAgent,a=/\bWin/.test(t)?"win":/\bMac/.test(t)?"mac":"other";e.addClass("os-"+a),Olv.Utils.isIE8AndEarlierStyle&&e.addClass("ie8-earlier"),Olv.Utils.isIEStyle&&e.addClass("ie")},Olv.Utils.addPlatformClass(),Olv.Utils.fixWebFontLoadTiming=function(){var e=document.createStyleSheet();e.cssText=":before, :after { content: none !important; }",setTimeout(function(){var t=e.owningElement;t.parentNode.removeChild(t)},20)},Olv.Utils.isIE8AndEarlierStyle&&Olv.init.done(Olv.Utils.fixWebFontLoadTiming),Olv.Utils.triggerHandlers={keypress:function(e){13!==e.which||e.isDefaultPrevented()||(e.preventDefault(),$(this).click())},mouseup:function(e){this.blur()}},Olv.init.done(function(e){e(document).on(Olv.Utils.triggerHandlers,".trigger")}),Olv.Content={},Olv.Form={toggleDisabled:function(e,t){var a=void 0===t;return e.each(function(){var e=$(this),s=a?!Olv.Form.isDisabled(e):t;if(e.toggleClass("disabled",s),void 0!==this.form)e.prop("disabled",s);else{var n=s?"href":"data-disabled-href",i=s?"data-disabled-href":"href",l=e.attr(n);void 0!==l&&(e.removeAttr(n),e.attr(i,l))}}),e},isDisabled:function(e){return e.length&&void 0!==e[0].form?e.prop("disabled"):e.hasClass("disabled")}},Olv.ModalWindowManager={},Olv.ModalWindowManager._windows=[],Olv.ModalWindowManager.currentWindow=null,Olv.ModalWindowManager.closeAll=function(){for(;this.currentWindow;)this.currentWindow.close()},Olv.ModalWindowManager.closeUntil=function(e){if(e.guard)for(var t;(t=this.currentWindow)&&(t.close(),t!==e););},Olv.ModalWindowManager.register=function(e){var t=this._windows;t.length?t[t.length-1].element.removeClass("active-dialog"):this.toggleMask(!0),e.element.addClass("active-dialog"),t.push(e),this.currentWindow=e},Olv.ModalWindowManager.unregister=function(e){if(this.currentWindow!==e)throw new Error("Failed to unregister modal window");var t=this._windows;t.pop().element.removeClass("active-dialog");var a=t.length?t[t.length-1]:null;a?a.element.addClass("active-dialog"):this.toggleMask(!1),this.currentWindow=a},Olv.ModalWindowManager._mask=null,Olv.ModalWindowManager.toggleMask=function(e){var t=this._mask;t||(t=this._mask=$("<div>",{class:"mask none"}).on("click",new Function).appendTo(document.body)),t.toggleClass("none",!e)},Olv.ModalWindowManager.setup=function(){$(document).on("click","[data-modal-open]",function(e){var t=$(this);if(!Olv.Form.isDisabled(t)&&!e.isDefaultPrevented()){e.preventDefault();var a=$.Event("olv:modalopen");if(t.trigger(a),!a.isDefaultPrevented()){var s=t.attr("data-modal-open"),n=$("#album-modal");(n=n.clone().removeAttr("id")).find(".modal-image").attr("src","./assets/user/img/ss/"+s),n.find(".created-at").text(t.attr("data-modal-created-at")),n.find(".album-close-button").attr("value"),new Olv.ModalWindow(n,this).open()}}}),$(document).on("click",".olv-modal-close-button",function(e){if(!e.isDefaultPrevented()){e.preventDefault();var t=Olv.ModalWindowManager.currentWindow;t&&t.close()}})},Olv.init.done(function(){Olv.ModalWindowManager.setup()}),$(document).on("olv:pagechange",function(){Olv.ModalWindowManager.closeAll()}),Olv.ModalWindow=function(e,t){this.element=$(e),this.triggerElement=$(t),this.temporary=!this.element.parent().length;var a=$.trim(this.element.attr("data-modal-types"));this.types=a?a.split(/\s+/):[],this.guard=null},Olv.ModalWindow.prototype.open=function(){if(!this.guard)return document.activeElement&&document.activeElement.blur(),Olv.ModalWindowManager.register(this),Olv.Form.toggleDisabled(this.triggerElement,!0),this.element.addClass("modal-window-open").removeClass("none"),this.temporary&&this.element.appendTo(document.body),this.triggerOpenHandlers($.Deferred()),this},Olv.ModalWindow.prototype.triggerOpenHandlers=function(e){this.guard=e;for(var t,a=[this,e.promise()],s=0;t=this.types[s];s++)this.element.trigger("olv:modal:"+t,a);this.element.trigger("olv:modal",a)},Olv.ModalWindow.prototype.close=function(){if(this.guard)return this.guard.resolve(),this.guard=null,Olv.ModalWindowManager.unregister(this),this.temporary&&this.element.remove(),this.element.addClass("none").removeClass("modal-window-open"),Olv.Form.toggleDisabled(this.triggerElement,!1),this};var userTemplate='{{#user}}<div class="sidebar-container">{{#cover_img}}<span id="sidebar-cover" style="background-image:url(./assets/user/img/{{cover_img}})"></span>{{/cover_img}}<div id="sidebar-profile-body" {{#cover_img}}class="with-profile-post-image"{{/cover_img}}><div class="icon-container"><img src="./assets/user/img/mii/normal.png" class="icon"></div><span class="nick-name">{{screen_name}}</span><p class="id-name">{{user_id}}</p></div></div><div class="sidebar-setting sidebar-container"><div class="sidebar-post-menu"><span class="sidebar-menu sidebar-menu-album with-count symbol"><span class="label">{{album_image_label}}</span><span class="post-count"><span>{{album_images_count}}</span></span></span>{{#sidebar_menu_posts}}<span class="sidebar-menu sidebar-menu-post with-count symbol{{#selected}} selected{{/selected}}" data-posts="{{data_label}}"><span class="label">{{label}}</span><span class="post-count"><span class="test-post-count">{{count}}</span></span></span>{{/sidebar_menu_posts}}</div></div><div class="sidebar-container sidebar-profile">{{#profile_comment}}<div class="profile-comment"><p>{{profile_comment}}</p></div>{{/profile_comment}}<div class="user-data"><div class="user-main-profile data-content"><h4><span>{{country_label}}</span></h4><div class="note">{{country}}</div><h4><span>{{birthday_label}}</span></h4><div class="note birthday">{{birthday}}</div></div><div class="game-skill data-content"><h4><span>{{game_skill_label}}</span></h4><div class="note"><span class="test-game-skill {{skill_class}}">{{skill}}</span></div></div><div class="game data-content"><h4><span>{{owned_game_device_label}}</span></h4><div class="note">{{#is_active_in_wiiu}}<div class="device-wiiu"><img src="./assets/common/img/wiiu.png" class="wiiu-icon"></div>{{/is_active_in_wiiu}}{{#is_active_in_n3ds}}<div class="device-3ds"><img src="./assets/common/img/n3ds.png" class="n3ds-icon"></div>{{/is_active_in_n3ds}}</div></div><div class="favorite-game-genre"><h4><span>{{favorite_game_genre_label}}</span></h4><div class="note">{{#favorite_game_genres}}<span>{{genre}}</span>{{/favorite_game_genres}}</div></div></div></div>{{/user}}<\/script>',postTemplate='<div class="list post-list js-post-list">{{#posts}}<div class="post post-subtype-diary with-image"><div class="community-container" {{#community}}data-community="{{community}}"{{/community}}{{#title}}data-title="{{title}}"{{/title}}><span class="post-subtype-label {{subtype_class}}">{{subtype}}</span></div><span class="icon-container"><img src="./assets/user/img/mii/{{mii}}.png" class="icon"></span><p class="user-name">{{screen_name}}</p><p class="timestamp-container">{{#spoiler}}<span class="spoiler">{{spoiler}}</span>{{/spoiler}}<span class="timestamp">{{created_at}}</span></p><div class="body"><div class="post-content"><div class="tag-container">{{#topic_tag}}<span class="post-tag symbol">{{topic_tag}}</span>{{/topic_tag}}{{#topic_category}}<span class="post-tag post-topic-category symbol">{{topic_category}}</span>{{/topic_category}}</div>{{#yt}}<a href="https://www.youtube.com/watch?v={{yt}}" class="screenshot-container video"><img height="48" src="https://i.ytimg.com/vi/{{yt}}/default.jpg" onerror="this.onerror = null;this.src=\'./assets/common/img/add-post-image-forbidden.png\'"></a>{{/yt}}{{#ss}}<span class="screenshot-container still-image"><img src="./assets/user/img/ss/{{#aid}}{{aid}}{{/aid}}{{^aid}}{{#karaoke}}karaoke{{/karaoke}}{{^karaoke}}{{id}}{{/karaoke}}{{/aid}}.jpg"></span>{{/ss}}{{#pa}}<p class="post-content-memo"><img src="./assets/user/img/pa/{{id}}.png" class="post-memo"></p>{{/pa}}{{#topic_category}}<p class="post-content-text topic-title">{{topic_post_title}}</p><p class="post-content-text topic-body">{{topic_post_body}}</p>{{/topic_category}}{{^topic_category}}<p class="post-content-text">{{body}}</p>{{/topic_category}}<div class="post-meta"><div class="empathy symbol"><span class="symbol-label"></span><span class="empathy-count">{{empathy_count}}{{^empathy_count}}0{{/empathy_count}}</span></div><div class="reply symbol"><span class="symbol-label"></span><span class="reply-count">{{reply_count}}{{^reply_count}}0{{/reply_count}}</span></div>{{#is_played}}<div class="played symbol"><span class="symbol-label"></span></div>{{/is_played}}</div></div></div></div>{{/posts}}</div>',albumImageTemplate='<div class="album-content"><ul class="list community-list community-small-list">{{#albumImages}}<li><div class="community-list-body"><span class="icon-container"><img src="./assets/user/img/icon/{{id}}.png" class="icon"></span><span class="body"><span class="title">{{name}}</span></span></div><div class="album-list">{{#album}}<a href="#" class="screenshot-container"data-modal-open="{{ss}}.jpg"data-modal-created-at="{{created_at}}"style="background-image:url(./assets/user/img/ss/{{ss}}.jpg)"></a>{{/album}}</div></li>{{/albumImages}}</ul></div>',albumModalTemplate='{{#user}}<div class="dialog-inner"><div class="window"><h1 class="window-title"></h1><div class="window-body"><div class="img-wrapper"><span class="created-at"></span><img class="modal-image" src=""></div><div class="window-footer"><input type="button" class="olv-modal-close-button button album-close-button" value="{{album_image_close_label}}"></div></div></div></div>{{/user}}';Olv.DownloadPage={},Olv.DownloadPage.init=function(){var e=Hogan.compile(userTemplate).render({user:userContent});$(".user-sidebar").append(e);var t=Hogan.compile(albumModalTemplate).render({user:userContent});$("#album-modal").append(t);var a=$(".sidebar-post-menu").find(".selected");Olv.LoadPosts(a,0),$(".sidebar-menu-post").on("click",function(){$(".sidebar-menu").removeClass("selected"),$(this).addClass("selected"),Olv.LoadPosts(this,0)}),$(".sidebar-menu-album").on("click",function(){$(".sidebar-menu").removeClass("selected"),$(this).addClass("selected"),Olv.LoadAlbumImages(this)}),$(".prev-button").on("click",function(){var e=$(".sidebar-post-menu").find(".selected"),t=$(".current-page").attr("data-page-num");$("html,body").animate({scrollTop:0},"fast"),Olv.LoadPosts(e,+t-1)}),$(".next-button").on("click",function(){var e=$(".sidebar-post-menu").find(".selected"),t=$(".current-page").attr("data-page-num");$("html,body").animate({scrollTop:0},"fast"),Olv.LoadPosts(e,+t+1)})},Olv.LoadPosts=function(selectedLabel,pageNum){$(".body-content").empty(),$(".pager-button").css("display","none"),$(".body-content").append("<div class='no-content'><p>now loading...</p></div>");var label=$(selectedLabel).find(".label").text();$(".post-list-outline h2.label").text(label);var postsData=$(selectedLabel).attr("data-posts");if(eval("typeof("+postsData+") != 'undefined'")){eval("var posts="+postsData+";");var limit=100,offset=limit*pageNum;limit<posts.length&&($(".pager-button").css("display",""),$(".current-page").attr("data-page-num",pageNum),$(".current-page").empty(),$(".current-page").append(pageNum+1+" / "+Math.ceil(posts.length/limit)),posts.length<=offset+limit?($(".prev-button").prop("disabled",!1),$(".next-button").prop("disabled",!0)):0==pageNum?($(".prev-button").prop("disabled",!0),$(".next-button").prop("disabled",!1)):($(".prev-button").prop("disabled",!1),$(".next-button").prop("disabled",!1)));var tmp=Hogan.compile(postTemplate),html=tmp.render({posts:posts.slice(offset,offset+limit),screen_name:userContent.screen_name});$(".body-content").empty(),$(".body-content").append(html),$(".community-container").each(function(e,t){var a,s;(title=t.getAttribute("data-title"))&&(a=title,s=titles[title].name),(community=t.getAttribute("data-community"))&&(a=communities[community].icon?communities[community].icon:community,s=communities[community].name),$(t).append('<img src="./assets/user/img/icon/'+a+'.png" class="community-icon">'+s)})}else{var fileName=$.grep(post_index,function(e){return e.var_name==postsData});$.isEmptyObject(fileName)?($(".body-content").empty(),$(".body-content").append("<div class='no-content'><p>"+userContent.post_empty+"</p></div>")):Olv.loadScript(fileName[0].file_name,function(){Olv.LoadPosts(selectedLabel,pageNum)})}},Olv.LoadAlbumImages=function(selected_label){$(".body-content").empty(),$(".pager-button").css("display","none");var label=$(selected_label).find(".label").text();if($(".post-list-outline h2.label").text(label),eval("typeof(albumImages) != 'undefined'")){var tmp=Hogan.compile(albumImageTemplate),html=tmp.render({albumImages:albumImages});$(".body-content").append(html)}else $(".body-content").append("<div class='no-content'><p>"+userContent.album_empty+"</p></div>")},Olv.loadScript=function(e,t){var a=document.createElement("script");a.type="text/javascript",a.src=e,a.readyState?a.onreadystatechange=function(){"loaded"!==a.readyState&&"complete"!==a.readyState||(a.onreadystatechange=null,t())}:a.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(a)},$(window).load(function(){Olv.DownloadPage.init()})}}).call(this,jQuery,Olv);