---
layout: page
title: 『すれちがい通信中継所』
description: >
  『すれちがい通信中継所』
hide_description: ture
---

![](/others/interviews/jp/3ds/streetpass_relay/vol1/img/mainvisual4.jpg){:.border.lead loading="lazy"}

### 4. 「こんなことも社内で？！」

河原
: DSの時の「すれちがい通信中継所」では、<br>DS本体を使って、データのやりとりをしていましたが、<br>今回は、「ニンテンドーゾーン」などの<br>アクセスポイントからアップロードされたデータは<br>いったんサーバーにためるようにしています。<br>そこで、自社でサーバーを用意しようとすると、<br>納品されるまで１か月くらい待たないといけませんでした。

 ![](/others/interviews/jp/3ds/streetpass_relay/vol1/img/photo12.jpg){:.border.border-radius width="250" height="150"  loading="lazy"}

岩田
: でも今回は、急ぐ必要がありますからね。

河原
: はい。そこで、今回はインフラに<br>「クラウドサービス」<sup>（※20）</sup>の利用を検討しました。<br>具体的には、AWS<sup>（※21）</sup>を利用しています。<br>これによって、<br>何台のサーバーを使おうと決めた時点で、<br>その日のうちに新しいサーバーが使えるという<br>とても便利な仕組みが利用できるようになりました。

「クラウドサービス」＝仮想サーバーやストレージ、ネットワークなどの計算資源を、必要な時に必要な分だけインターネットを通じて利用できるサービス。
{:.note-sm .faded title="※20"}

AWS＝Amazon Web Services。Amazon.comが提供するウェブサービス。国内外の数多くの企業がこのサービスを利用している。
{:.note-sm .faded title="※21"}

岩田
: 今回の「中継所」のように、<br>世界中にある１０万か所ものアクセスポイントから<br>どれだけの数のアクセスがあるのか、<br>事前に予想することのできないサービスをつくるときに<br>とても向いているのがクラウドにサーバーを用意することなんですね。<br>そうすれば、状況に応じてサーバーを簡単に増設できますし、<br>いらなければ簡単に減らすこともできますしね。

河原
: そうなんです。

岩田
: じつはWii UのMiiverse<sup>（※22）</sup>も<br>同じような仕組みでつくられていますし、<br>世の中の大規模なウェブサービスのサーバー構成は<br>どんどんクラウド化しつつあるんですよね。

 class="interview__note">

Miiverse＝Miiを通じて世界中の人たちがつながる、Wii Uにシステムレベルで統合された、ゲームをもっと楽しむためのネットワークサービス。好きなゲームソフトの広場で感想を述べあったり、手描きの絵やコメントを書き込んだりしながら交流できる。
{:.note-sm .faded title="※22"}

山崎
: はい。やっぱり、これほどの短期間で<br>このようなサービスをはじめるには、<br>クラウド抜きでは考えられませんでした。<br>それと、もうひとつ理由がありまして、<br>今回はレスポンスを早める必要が求められました。<br>お客さんが「中継所」にやってきたとき、<br>その人のデータを受け取って、<br>別の人のデータをお渡ししないといけませんので・・・。

岩田
: もたもたしていると、<br>お客さんはどこかに行ってしまいますよね。

山崎
: そうなんです。そこで、開発時には<br>アメリカ向けのサーバーはアメリカに置く、<br>みたいに、それぞれのエリア内に<br>サーバーを置くことも検討をしていました。<br>評価の結果、最終的には１か所に集約したのですが、<br>こういったことも柔軟に対応できるところなどは、<br>AWSというサービスが向いていたと思います。

岩田
: ちなみに、「中継所」で<br>「すれちがい通信」が完了するまで<br>どのくらいの時間がかかるんですか？

紺野
: これは、個人的に測ったデータなんですけど、<br>速いところだと２、３０秒、<br>時間がかかっても１分程度です。

![](/others/interviews/jp/3ds/streetpass_relay/vol1/img/photo13.jpg){:.border.border-radius width="250" height="150"  loading="lazy"}

井上
: 通信環境によって変わりますが、<br>接続するまでの時間がけっこうかかるので<br>体感としてはそれぐらいだと思います。<br>サーバー側の処理としてはほとんど１秒未満です。

河原
: あの・・・サービスを早く開始するために<br>取り入れたことがいくつかあるんですが、<br>まだよろしいですか？

岩田
: はい、どうぞ。

河原
: 社内には、<br>オープンソースソフトウェアを積極的に活用している<br>サーバー開発者のチームがいくつかありまして、<br>わたしたちもそのひとつなのですが、<br>今回もたくさんのオープンソースソフトウェアを使用しています。

岩田
: オープンソースソフトウェアというのは、<br>インターネットの上に設計情報やプログラムが公開されていて、<br>それは誰でも使用できる、オープンなものなので、<br>世界中のプログラマーの方たちによって<br>磨き上げられていくソフトのことですね。<br>代表的なものでは、ＯＳのLinux<sup>（※23）</sup>が有名ですけど。

Linux＝フィンランドの大学生によって開発されたＯＳ。その後、フリーウェアとして公開され、さまざまな開発者によって改良が重ねられている。
{:.note-sm .faded title="※23"}

河原
: そうですね。<br>そのオープンソースソフトウェアで<br>今回はHBase<sup>（※24）</sup>というプロダクトを、<br>データベースとして採用しました。<br>HBaseは書き込み性能が高く、<br>サーバー台数を増やすことで、<br>システムの性能を高めることも得意なんです。<br>ひんぱんにデータの書き込みが発生して、かつ負荷状況に応じて<br>柔軟にインフラの性能を上げていく必要がある<br>今回のようなケースに向いていると考えました。<br>別のプロジェクトで昨年末ぐらいから試験的に運用していて、<br>少しずつノウハウもたまってきたところでした。

 class="interview__note">

HBase＝アメリカのオープンソースソフトウェアを支援する財団によって開発されたプロダクト。FacebookやLINEなどの、大手ＳＮＳの会社でも利用されている。
{:.note-sm .faded title="※24"}

岩田
: オープンソースソフトウェアですから、<br>任天堂以外の一般のウェブ企業のみなさんも<br>使っている仕組みですよね。

河原
: そうです。<br>それにPuppet<sup>（※25）</sup>という<br>オープンソースソフトウェアも利用しています。<br>これはサーバーの構成管理ソフトウェアなんですけど、<br>じつは３年前からこのプロダクトを使っていまして、<br>新規にプロジェクトを立ち上げるときには<br>既存の構成設定を再利用できるようにしています。

 class="interview__note">

Puppet＝システム管理を自動化するための構成管理ツール。Rubyというプログラミング言語で実装されている。
{:.note-sm .faded title="※25"}

岩田
: 大規模なネットワークサービスをはじめるには、<br>まず、複数のサーバーを連携させる必要があるんですが、<br>その構成を管理するだけでも大仕事になりますから、<br>専用のソフトを使って管理するわけですね。<br>いつ、新しいプロジェクトがはじまってもいいように<br>早めに準備をしていたんですね。

河原
: はい。<br>なので、今回のプロジェクトがスタートしてから、<br>３か月ほどでリリースできたのは、<br>前もってPuppetを取り入れていたからだと思います。<br>それから同じくオープンソースソフトウェアで、<br>fluentd<sup>（※26）</sup>と呼ばれるシステムも<br>今回は採用しました。<br>これは、サーバーにたまっていくさまざまなログを、<br>リアルタイムに収集したり整形したりして、<br>解析をしやすくするための仕組みです。

fluentd＝ログ収集基盤ソフトウェア。Rubyで実装されている。ログの保存や大規模データの解析基盤と一緒に利用されることが多い。
{:.note-sm .faded title="※26"}

岩田
: そのfluentdを使うことで、<br>どのようなお客さんが、どれくらいの数、<br>どのアクセスポイントですれちがっているか、<br>といったことが、瞬時にわかるんですね？

河原
: そうです。<br>これによって、１分くらいのタイムラグで<br>すべての状況がわかるようになりました。<br>あと、もうひとつだけ・・・。

岩田
: はい、どうぞ（笑）。

河原
: われわれのチームはRuby<sup>（※27）</sup>を<br>得意とするメンバーが多いのですが、<br>今回のシステムでもさまざまな箇所で<br>Rubyを利用しています。

Ruby＝ストレスなくプログラミングすることを目的に開発されたプログラミング言語のひとつ。
{:.note-sm .faded title="※27"}

岩田
: Rubyというのは、まつもとゆきひろさんという<br>日本の方が開発した有名なプログラミング言語ですね。

河原
: はい。<br>Java<sup>（※28）</sup>やPerl<sup>（※29）</sup>のように<br>別の言語を使っているチームもあるんですが、<br>今回はできるだけ早く<br>サービスを開始する必要がありましたので、<br>自分たちの得意な軽量言語であるRubyを採用しました。

Java＝プログラミング言語のひとつで、ユーティリティー、ゲーム、ビジネスアプリケーションなど、さまざまな分野で利用されている。
{:.note-sm .faded title="※28"}

Perl＝プログラミング言語のひとつで、ウェブアプリケーションやシステム管理、テキスト処理などに利用されることが多い。
{:.note-sm .faded title="※29"}

岩田
: そもそも任天堂という会社では、<br>ゲームをつくっている人がたくさんいるということは<br>世間的にもよく知られているんですけど、<br>サーバーのシステムを構築したり、<br>管理・運営するような仕事は<br>外部の会社の人にお願いしているだけで、<br>社内では誰もやっていないんじゃないか、と<br>そう思っておられる方も多いようなんです。<br>でも、じつはそうじゃないんですよね。

山崎
: はい。<br>ネットワーク開発運用部だけでも１００人を超えていて、<br>そのほとんどがエンジニアです。<br>クライアント側のエンジニアもいますので、<br>すべてがサーバーエンジニアというわけではないですが。

岩田
: ですから、転職してきた人が、<br>「こんなことも社内でやってたんですか！？」<br>と驚くようなことが、けっこうあると聞いています。

![](/others/interviews/jp/3ds/streetpass_relay/vol1/img/photo14.jpg){:.border.border-radius width="250" height="150"  loading="lazy"}

紺野
: それにしても、DSの時代と比べると<br>隔世の感がありますね。すごく進化したというか。<br>DSの時はDS実機が「中継所」だったのに（笑）。

岩田
: 山崎さんたちが手作業で<br>コインロッカーに入れていたくらいですからね（笑）。

一同
: （笑）

岩田
: でも今回は、もともとお店にある<br>「ニンテンドーゾーン」の仕組みを利用して、<br>サーバーと3DS本体のソフトだけを変えて<sup>（※30）</sup>、<br>実現できるようにするというのを目標にして<br>個々のアクセスポイントをそのまま使えるようにしましたから、<br>サービス開始まで、とても早くできたわけですね。

 class="interview__note">

3DS本体のソフトだけを変えて＝「すれちがい通信中継所」を利用できるのは、システムバージョンが「6.2.0-0J」以上のニンテンドー3DS。本体のバージョンがそれ以前の場合は、本体更新が必要となる。
{:.note-sm .faded title="※30"}

河原
: そうですね。

紺野
: じつは・・・<br>今回のプロジェクトをはじめるにあたって、<br>わたしのプランとしては、２案あったんです。<br>既存のアクセスポイントを使ってやる方法と、<br>DSの当時やった、物理的に設置する方法なんですけど、<br>「どっちが現実的ですか？」と<br>最初に聞いてみたんです。

岩田
: 後者は「ありえません」と言われたんでしょう？（笑）

紺野
: はい。言われました（笑）。

山崎
: 「かんべんしてください」と言いました。<br>コインロッカーに入れてまわるのでは、<br>とても世界中には展開できないですから（笑）。

一同
: （笑）

[5. 「国ちがい通信」も？](5.md)
{:.read-more}
